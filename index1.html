<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    
  </head>
  
<body>

  
  <script src="cursorMovements.js"></script>
  <script src="customBox.js"></script>
  <script src="recursive.js"></script>
  <script>
    
    const CursorMovements = new CursorMovementsClass()
    const customBox1 = new CustomBoxClass()
    const Recursive = new RecursiveClass() 
    //const Insert = new RecursiveClass() 
    //alert("here");
    /*
    let nestedArray = [
    ["-", "A", "C","-", "-", "-","-", "-", "-", "-" ],
    ["-", "B", "D","-", "-", "-","-", "-", "-", "-" ],
    ["-", "-", "-","-", "-", "-","-", "-", "-", "-" ],
    ["-", "-", "-","-", "-", "-","-", "-", "-", "-" ],
    ["-", "-", "-","-", "-", "-","-", "-", "-", "-" ],
    ["-", "-", "-","-", "-", "-","-", "-", "-", "-" ],
    ["-", "-", "-","-", "-", "-","-", "-", "-", "-" ],
    ["-", "-", "-","-", "-", "-","-", "-", "-", "-" ],
    ["-", "-", "-","-", "-", "-","-", "-", "-", "-" ],
    ["-", "-", "-","-", "-", "-","-", "-", "-", "-" ],
    ];  
    */
  
 
    

    </script>
    <canvas
      id="canvas_id"
      width="220"
      height="240"
      style="border: 1px solid #550233"
    > </canvas>
    <button id="button6" onclick="TextArea.displayTextBoxCopy()">
      Display Text
    </button>

    <div></div>
    <div id="xAndY"></div>

    
      
    <script>
      
      let nestedArray = [
  ["-", "-", "-", "-", "-", "-" , "-"],
  ["-", "-", "-", "-", "-", "-" , "-"],
  ["-", "-", "-", "A", "-", "-" , "-" ],
  ["1", "2", "3", "-", "Z", "-" , "-" ],
  ["-", "-", "-", "-", "Y", "-" , "-" ],
  ["-", "-", "-", "-", "-", "-" , "-" ],
  ["-", "-", "-", "-", "-", "-" , "-" ],
  
];

      let WIDTH = 7
      let HEIGHT = 7

      //vertical and horizontal offset of canvas
      const VOFFSET = 25
      const HOFFSET = 30
      //nestedarray holds values with an array - 35 by 35
      var canvas = document.getElementById('canvas_id')
      //insert is on or off
      var insertOn = document.getElementById('insert')
      let textBox = [[]]
      //rows and columns of canvas
      let rows = WIDTH
      let cols = HEIGHT
      //this is so that the canvas will look okay on a big display
      let ctx = canvas.getContext('2d')
      var size = 220
      canvas.style.width = size + 'px'
      canvas.style.height = size + 'px'
      // Set actual size in memory (scaled to account for extra pixel density). // Change to 1 on retina screens to see blurry canvas.
      var scale = window.devicePixelRatio 
      canvas.width = size * scale
      canvas.height = size * scale
      // Normalize coordinate system to use css pixels.
      ctx.scale(scale, scale)
      ctx.fillStyle = '#ffffff'
      ctx.fillRect(0, 0, 800, 800)
      ctx.fillStyle = '#000000'
      ctx.font = '10px Monospace'
      ctx.textAlign = 'center'
      ctx.textBaseline = 'middle'
      var x = size / 2
      var y = size / 2
      var indexOfXForLineBeforeLastRowSpace = 0
      var lastIndexValueForInsert = -1
      var firstLengthOfOverlap = 0
      var sencondLengthOfOverlap = 0
      

  function findBeginningX(y) {
  //find the index value of the last value ,"-" of the string"
  this.indexOfXForLineBeforeLastRowSpace = 0
    for (let x = 0; x < WIDTH; x++) {
      if (nestedArray[y][x] === "-") {
        console.log("G:", this.indexOfXForLineBeforeLastRowSpace);
        this.indexOfXForLineBeforeLastRowSpace = x + 1 ;  
      }
    }
    return;
  }

  /*
  function getLastIndexValueForInsert(){
    for (let x = 0; x < WIDTH; x++) {
      if (nestedArray[y][x] === " ") {
        lastIndexValueForInsert = x;
      }else{
        break;
      }
    }
  }

  function firstRowLenghtOfOverflow(){
    firstLengthOfOverlap = (WIDTH -lastIndexValueForInsert+1) 
  }
  
  secondLengthOfOverlap = lastIndexValueForInsert+1
*/

  
      function enlargeTextbox(){

      }


      function clearArray() {
        //alert("clear");
        ctx.clearRect(0, 0, 100, 100)
        ctx.fillStyle = '#ffffff'
        ctx.fillRect(0, 0, canvas.width, canvas.height)
        ctx.fillStyle = '#000000'
      }

      function drawGrid(iValue = HEIGHT, jValue = WIDTH) {
        

        //iValue = 9;
        //jValue = 11
        //alert("dG")
        //cols
        clearArray()
        //HEIGHT might have changed
        //WIDTH = iValue
        //HEIGHT = jValue

        ctx.fillStyle = 'black'
        //columns
        for (let i = 0; i < iValue; i++) {

         
        //rows
        for (let j = 0; j < jValue ; j++) {
        //fill a square canvas with letter values
        console.log("na: ", nestedArray)
        if(nestedArray && nestedArray[i] && nestedArray[i][j]){
          
        
        ctx.fillText(nestedArray[i][j], j * 5 + 25, i * 10 + 25)
        console.log({j}, {i})
        }else{
          continue
        }
        }
        
      }
      
    }

      function drawCursor(x,y){

        //VOFFSET = 25
        //HOFFSET = 30

        //alert(x)
        if(x === 65){

          if(x == HOFFSET + (WIDTH * 5))
          x = 0 + HOFFSET;
          console.log("y1: ", y)
          y =y + 10
          console.log("y2: ", y)
        }
        //{
        //  alert("here")
        //  x=0
        //  y=verticalCursorPosition/10 + 10 + VOFFSET
        //}
        //alert("dc: x", x);
        
        ctx.font = '10px Monospace'
        //y = 30
        ctx.fillStyle = 'red'
        console.log("y: ", y)
        ctx.fillText('_', x - 5, y)
      }

      let horizontalCursorPosition = 0
      let verticalCursorPosition = 0
      let gKey = ''
      let gInsert = false


      let amtAdditionalRows = 0;

      function createNextRow()
      {
      
        Recursive.pressedEnter(nestedArray, verticalCursorPosition/10, horizontalCursorPosition/5)
       
      
        return 
      
        alert("?!?!") 
        let retValue = true
        //if ((HEIGHT + amtAdditionalRows <= verticalCursorPosition/10+ 1) )
        {
        nestedArray.push (["A", "-", "-", "-", "-", "-" , "-" ],)

        HEIGHT++
        //drawGrid(WIDTH, heightOfGrid)
        drawGrid(HEIGHT, WIDTH)

        verticalCursorPosition = verticalCursorPosition + 10
         drawCursor(


          horizontalCursorPosition + HOFFSET,
          verticalCursorPosition + VOFFSET
        )
        
        amtAdditionalRows = amtAdditionalRows + 1
        //printCharacter()
        
          //return retValue
        }
        //retValue = false
        //return retValue
        return 1
    
    
      }
      //InsertNewArr(nestedArray, " ", horizontalCursorPosition/5, verticalCursorPosition/10 )
      function printCharacter() {

        let rowIndex = horizontalCursorPosition/5;
        let colIndex = verticalCursorPosition/10;
        //insertNewArr(nestedArray, " ", rowIndex, colIndex)
        //alert("print");
        ctx.clearRect(0, 0, 300, 300)
        console.log('v ', verticalCursorPosition)
        console.log('h ', horizontalCursorPosition)
        
        //key pressed is stored in nestedArray
        //nestedArray[verticalCursorPosition / 10][horizontalCursorPosition/5] = gKey
        
        //key is inserted into nested array, rebulids form that point in time
       /*
        let nestedArray = [
  ["h", "e", "l", "l", "-"],
  ["-", "g", "-", "-", "-", "-", "-"],
  //["-", "-", "-", "-", "-", "-" , "-" ],
  //["-", "-", "-", "-", "-", "-" , "-" ],
  //["-", "-", "-", "-", "-", "-" , "-" ],
  //["-", "-", "-", "-", "-", "-" , "-" ],
  //["-", "-", "-", "-", "-", "-" , "-" ],
  
];
*/
        let key = "Z"
       
        //gKey = "Z"
        console.log("nested array1: ", nestedArray);
        //nestedArray = Recursive.insertClean(true, nestedArray, [gKey, gKey], verticalCursorPosition/10, horizontalCursorPosition/5 )
        nestedArray = Recursive.insertClean(true, nestedArray, [gKey], verticalCursorPosition/10, horizontalCursorPosition/5 )
        //nestedArray = Recursive.insertClean(true, nestedArray, ["1", "a","x", "a", "x", "a","x","2", "a","x","x", "a","x","x", "3","a", "x","x", "a","x","z"], verticalCursorPosition/10, horizontalCursorPosition/5 )
        
        //nestedArray = Recursive.passInHere(true, nestedArray,key, verticalCursorPosition/10, horizontalCursorPosition/5 )
        console.log("nested array2: ", nestedArray);
        
        
        drawGrid( WIDTH, HEIGHT)
        //At edge of canavs - use for edge cases, later.
        //bookmark
        if (horizontalCursorPosition < (WIDTH - 1) * 5) {
          horizontalCursorPosition = horizontalCursorPosition + 5
        }else{
          horizontalCursorPosition = 0;
          verticalCursorPosition = verticalCursorPosition + 10
          //alert("here1");
        }
        
        console.log("vert: ", verticalCursorPosition/10)
        drawCursor(


          horizontalCursorPosition + HOFFSET,
          verticalCursorPosition + VOFFSET
        )

      }

      //function insertClean("aa", "aa", 0, 5){};
  
      document.addEventListener('keydown', function (e) {
        //global variable
        gKey = e.key
        

        if(gKey == 'Enter')
        {
          
          alert("caught2")
          createNextRow()
          
        }
        if(gKey == 'Delete')
        {
          
          //Recursive.adjustForWordBreaks_TopToBottom_LeftKeyPress(nestedArray, [gKey], verticalCursorPosition/10, horizontalCursorPosition/5)
    
             //THIS IS IT :  
             //Recursive.deleteCharacters(nestedArray, 0,  verticalCursorPosition/10+1, horizontalCursorPosition/5)
        
             console.log("nested array3: ", nestedArray);
             //nestedArray =  Recursive.moveAllWordsAcrossBorder(nestedArray, [], verticalCursorPosition/10, horizontalCursorPosition/5)
             nestedArray = Recursive. adjustForWordBreaks_TopToBottom_LeftKeyPress( nestedArray,verticalCursorPosition/10, horizontalCursorPosition/5)
             console.log("nested array4: ", nestedArray);
            }

        //printCharacter()
        heightOfGrid = customBox1.controlInput()
        
        console.log({heightOfGrid})
         
       
       
        if(heightOfGrid >= 0)
        {

          createNextRow()
        }

          
         
       

        
      })
      //display helpful data
      xAndY.innerHTML = 'X: ' + 0 + '  &nbsp&nbsp&nbsp   Y: ' + 0
      

      /*I
      window.addEventListener('keydown', function (e) {
        //alert("5");
        //customBox1.controlInput()
        if (
          ['Space', 'ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].indexOf(
            e.code
          ) > -1
        ) {
          e.preventDefault()
        }
      })
      */

      </script>
      
    </body>
