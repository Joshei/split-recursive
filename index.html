  <html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
  <script src="cursorMovements.js"></script>
  <script src="customBox.js"></script>
  <script src="recursive.js"></script>
  <script>
    const CursorMovements = new CursorMovementsClass()
    const customBox1 = new CustomBoxClass()
    const Recursive = new RecursiveClass() 
    let FIRSTSETHEIGHT = 200
    </script>
    <canvas
      id="canvas_id"
      width="220"
      height=FIRSTSETHEIGHT
      style="border: 1px solid #550233"
    > </canvas>
    <div id="xAndY"></div>
  <script>
  let horizontalCursorPosition = 0
  let verticalCursorPosition = 0
  
  // The grid, last row is a padding for recursion. 
  let gridArray = [
    ["-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-","-", "-", "-", "-", "-", "-" , "1" ],
    ["-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-","-", "-", "-", "-", "1", "-" , "1" ],
    ["-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-","-", "-", "-", "-", "-", "-" , "-" ],
    ["-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-","-", "t", "-", "-", "r", "-" , "-" ],
    
    ["q", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-","-", "-", "-", "-", "-", "-" , "1" ],
    ["a", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-","-", "-", "-", "-", "-", "-" , "1" ],
    ["-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-","a", "-", "-", "-", "-", "-" , "1" ],
    ["1", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-","-", "-", "-", "-", "-", "-" , "-" ],
    ["-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-","-", "-", "-", "-", "-", "-" , "-" ],
    ["A", "A", "A", "A", "A", "A" , "A", "A", "A", "A", "A", "A", "A" , "A", "A", "A", "A", "A", "A", "A" , "A","A", "A", "A", "A", "A", "A" , "A" ],
    
    ["1", "2", "B", "Z", "B", "A" , "A", "A", "A", "A", "A", "A", "A" , "A", "A", "A", "A", "A", "A", "A" , "A","A", "A", "A", "A", "A", "1" , "A" ],
    
    ["3", "4", "B", "B", "B", "A" , "A", "A", "A", "A", "A", "A", "A" , "A", "A", "A", "A", "A", "A", "A" , "A","A", "A", "A", "A", "A", "1" , "A" ],
    ["p", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-","-", "-", "-", "-", "-", "-" , "-" ],
    ["-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-","-", "-", "-", "-", "B", "B" , "B" ],
    ["-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-","-", "-", "-", "-", "A", "-" , "A" ],
    //["-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-","-", "-", "-", "-", "B", "B" , "B" ],
    
    ["!", "!", "!", "!", "!", "!" , "!", "!", "!", "!", "!", "!", "!" , "!", "!", "!", "!", "!", "!", "!" , "!", "!","!", "!", "!", "!", "!" , "!" ],
];

  //canvas
  let WIDTH = 28
  let HEIGHT = 15
  let ORIGINALHEIGHT = 15
  const VOFFSET = 32
  const HOFFSET = 35
  var canvas = document.getElementById('canvas_id')
  var insertOn = document.getElementById('insert')
  let textBox = [[]]
  let rows = WIDTH
  let cols = HEIGHT
  let ctx = canvas.getContext('2d')
  var size = 220
  canvas.style.width = size + 'px'
  canvas.style.height = size + 'px'
  var scale = window.devicePixelRatio 
  canvas.width = size * scale
  canvas.height = size * scale
  ctx.scale(scale, scale)
  ctx.fillStyle = '#ffffff'
  ctx.fillRect(0, 0, 800, 800)
  ctx.fillStyle = '#000000'
  ctx.font = '10px Monospace'
  //ctx.textAlign = 'center'
  //ctx.textBaseline = "bottom"
  var x = size / 2
  var y = size / 2
  
  //clears out grid
  function clearArray() {
    ctx.clearRect(0, 0, 100, 100)
    ctx.fillStyle = '#ffffff'
    ctx.fillRect(0, 0, canvas.width, canvas.height)
    ctx.fillStyle = '#000000'
  }
  
  function makeCanvas(verticalSize = FIRSTSETHEIGHT){

    //return
  //15 220   15
  var size = verticalSize// HEIGHT * 10 + 45//HEIGHT * 10 + 50
  let hsize = 200
  canvas.style.width = hsize + 'px'
  canvas.style.height = size + 'px'
  var scale = window.devicePixelRatio 
  canvas.width = size * scale
  canvas.height = size * scale
  ctx.scale(scale, scale)
  ctx.fillStyle = '#ffffff'
  ctx.fillRect(0, 0, 800, 800)
  ctx.font = '10px Monospace'
  ctx.textAlign = 'center'
  //ctx.textBaseline = 'bottom'


  }
  //draws grid
  function drawGrid(iValue = HEIGHT, jValue = WIDTH) {

    
    //let oneCharHeight = FIRSTSETHEIGHT/15
    let extraHeightRows = HEIGHT - ORIGINALHEIGHT
    let totalVert = extraHeightRows*10 + 200
    //let extraCanvasHeight = oneCharHeight * extraHeightRows

    makeCanvas(totalVert)

    clearArray()
    ctx.fillStyle = 'black'
    for (let i = 0; i < iValue; i++) {
    for (let j = 0; j < jValue ; j++) {
    console.log("na: ", gridArray)
    if(gridArray && gridArray[i] && gridArray[i][j]){
    
      //INCREASING CANVAS WITH THIS INFORMATION:
      //UNDERSTAND CODE FOR STOP AT MAX WIDTH AND MAX HEIGHT
    ctx.fillText(gridArray[i][j], j * 5 + 30 , i * 10 + 33)
    console.log({j}, {i})
    }else{
      continue
    }
    }
  }
}

  //draws cursor on grid
  function drawCursor(x,y){
    //28 tiles times 5 is 140
    if(x === HOFFSET + 140){
      if(x == HOFFSET + (WIDTH * 5))
      x = 0 + HOFFSET;
      y =y + 10
    }
    ctx.font = '10px Monospace'
    ctx.fillStyle = 'red'
    console.log("y: ", y)
    ctx.fillText('_', x - 5, y)
    }
    
    let gKey = ''
    var keyState = {}
    let eventKeyCode = ""
    let down = false
    
    document.body.addEventListener('keydown', function(e){
    keyState[e.keyCode || e.which] = true;
    eventKeyCode = e.keyCode
    gKey = e.key
    if (down) return
    down = true
    //for testing
    //gridArray = Recursive.test(gKey, gridArray, verticalCursorPosition/10)
    cursorAndFunctionCalls()
    }, false)
    
    document.addEventListener('keyup', function(e){
    keyState[e.keyCode || e.which] = false;
    gKey = e.key
    //e.repeat= false
    eventKeyCode = e.keyCode
    down = false
    }, false)
     
    function cursorAndFunctionCalls() {
    //right
    if(keyState[39]){
    //move to right double, altogether
    Recursive.advanceHorizontalOneTime()
    CursorMovements.cursorRight() 
    }
    //left
    else if(keyState[37]){
      CursorMovements.cursorLeft()
    }
    //up
    else if(keyState[38]){
      CursorMovements.cursorUp()
    }
    //move down double, all together
    else if(keyState[40]){
      //Recursive.advanceVerticalOneTime()
      CursorMovements.cursorDown()
    } 
    else if(gKey == 'Delete')
    {
       console.log("nested array3: ", gridArray);
       gridArray = Recursive.deleteACharacter([], verticalCursorPosition/10, horizontalCursorPosition/5-1,  gridArray)
    }
    else{
    //3 main functions to use
    gridArray = Recursive.initialInsert(verticalCursorPosition/10, horizontalCursorPosition/5, gridArray, gKey)
      //gridArray =  Recursive.pullTextBackToTop(true, gKey, gridArray, verticalCursorPosition/10, horizontalCursorPosition/5)
      //gridArray = Recursive.pushWords(true, gridArray,[gKey],verticalCursorPosition/10, horizontalCursorPosition/5)
      
    }
    Recursive.displayGridAndCursor()  
    }  

    cursorAndFunctionCalls()
/*      
      const test = document.addEventListener('keydown', function (e) {
      else if(gKey == 'Enter')
      {
        HEIGHT++
        //gridArray = Recursive.pressedEnter(gridArray, verticalCursorPosition/10, horizontalCursorPosition/5, [], [], true)
        const t0 = performance.now()
        let a = pausehere
      
      }
      else if(gKey == 'Delete')
      {
        alert("delete")
          console.log("nested array3: ", gridArray);
          //4 functions:
          //gridArray =  Recursive.pullTextBackToTop(true, gridArray, verticalCursorPosition/10, horizontalCursorPosition/5)
          //gridArray = Recursive.pushWords(true, gridArray,[],verticalCursorPosition/10, horizontalCursorPosition   
      }
    })
*/
/*
  let down = false
    document.addEventListener('keydown' , function (e){
      gKey = e.key
      if(down) return
      down = true

      gridArray = Recursive.test(gKey, gridArray, verticalCursorPosition/10)

    }, false);

    document.addEventListener('keyup' , function (e){
      gKey = e.key
      down = false}, false)
*/
    </script>
    </body>
