0<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
<body>
  <script src="cursorMovements.js"></script>
  <script src="customBox.js"></script>
  <script src="recursive.js"></script>
  <script>
    const CursorMovements = new CursorMovementsClass()
    const customBox1 = new CustomBoxClass()
    const Recursive = new RecursiveClass() 
    </script>
    <canvas
      id="canvas_id"
      width="220"
      height="240"
      style="border: 1px solid #550233"
    > </canvas>
    <div id="xAndY"></div>
    <div id="speedAdjust"></div>

    <script>
      const MAXSPEED = 190
      speedAdjust.innerHTML =
      `Cursor speed: 100%` 
        
      

    // The grid, last row is a padding for recursion. 
    let nestedArray = [
     ["-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-","-", "-", "-", "-", "-", "-" , "-" ],
     ["-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-","-", "-", "-", "-", "-", "-" , "-" ],
     ["-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-","-", "-", "-", "-", "-", "-" , "-" ],
     ["-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-","-", "-", "-", "-", "-", "-" , "-" ],
     ["-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-","-", "-", "-", "-", "-", "-" , "-" ],
     ["-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-","-", "-", "-", "-", "-", "-" , "-" ],
     ["-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-","-", "-", "-", "-", "-", "-" , "-" ],
     ["-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-","-", "-", "-", "-", "-", "-" , "-" ],
     ["-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-","-", "-", "-", "-", "-", "-" , "-" ],
     ["-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-","-", "-", "-", "-", "-", "-" , "-" ],
     ["-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-","-", "-", "-", "-", "-", "-" , "-" ],
     ["-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-","-", "-", "-", "-", "-", "-" , "-" ],
     ["-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-","-", "-", "-", "-", "-", "-" , "-" ],
     ["-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-","-", "-", "-", "-", "-", "-" , "-" ],
     ["-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-", "-", "-", "-", "-", "-", "-" , "-","-", "-", "-", "-", "-", "-" , "-" ],
     ["!", "!", "!", "!", "!", "!" , "!", "!", "!", "!", "!", "!", "!" , "!", "!", "!", "!", "!", "!", "!" , "!", "!","!", "!", "!", "!", "!" , "!" ],
  ];
      //canvas
      let WIDTH = 28
      let HEIGHT = 15
      let ORIGINALHEIGHT = 10
      const VOFFSET = 25
      const HOFFSET = 30
      var canvas = document.getElementById('canvas_id')
      var insertOn = document.getElementById('insert')
      let textBox = [[]]
      let rows = WIDTH
      let cols = HEIGHT
      let ctx = canvas.getContext('2d')
      var size = 220
      canvas.style.width = size + 'px'
      canvas.style.height = size + 'px'
      var scale = window.devicePixelRatio 
      canvas.width = size * scale
      canvas.height = size * scale
      ctx.scale(scale, scale)
      ctx.fillStyle = '#ffffff'
      ctx.fillRect(0, 0, 800, 800)
      ctx.fillStyle = '#000000'
      ctx.font = '10px Monospace'
      ctx.textAlign = 'center'
      ctx.textBaseline = 'middle'
      var x = size / 2
      var y = size / 2
      let adjustableSpeed = 0
      //@var indexOfXForLineBeforeLastRowSpace = 0
      //@var lastIndexValueForInsert = -1
      //@var firstLengthOfOverlap = 0
      //@var sencondLengthOfOverlap = 0
      const variable = [
        {code:65, value:'a'}, {code:66, value:'b'}, {code:67, value:'c'}, {code:68, value:'d'}, {code:69, value:'e'}, {code:70, value:'f'}, {code:71, value:'g'}, {code:72, value:'h'}, {code:73, value:'i'}, {code:74, value:'j'}, {code:75, value:'k'}, {code:76, value:'l'}, {code:77, value:'m'}, {code:78, value:'n'}, {code:79, value:'o'}, {code:80, value:'p'}, {code:81, value:'q'}, {code:82, value:'r'}, {code:83, value:'s'}, {code:84, value:'t'}, {code:85, value:'u'}, {code:86, value:'v'}, {code:87, value:'w'}, {code:88, value:'x'}, {code:89, value:'y'}, {code:90, value:'z'}  ]
     

      
      
    function clearArray() {
        ctx.clearRect(0, 0, 100, 100)
        ctx.fillStyle = '#ffffff'
        ctx.fillRect(0, 0, canvas.width, canvas.height)
        ctx.fillStyle = '#000000'
      }


    
    function drawGrid(iValue = HEIGHT, jValue = WIDTH) {
        clearArray()
        ctx.fillStyle = 'black'
        for (let i = 0; i < iValue; i++) {
        for (let j = 0; j < jValue ; j++) {
        console.log("na: ", nestedArray)
        if(nestedArray && nestedArray[i] && nestedArray[i][j]){
        //fill text with offsets
        ctx.fillText(nestedArray[i][j], j * 5 + 25 , i * 10 + 25)
        console.log({j}, {i})
        }else{
          continue
        }
        }
      }
    }
    
    
    function drawCursor(x,y){
        //28 tiles times 5 is 140
        if(x === HOFFSET + 140){
          if(x == HOFFSET + (WIDTH * 5))
          x = 0 + HOFFSET;
          console.log("y1: ", y)
          y =y + 10
          console.log("y2: ", y)
        }
        ctx.font = '10px Monospace'
        ctx.fillStyle = 'red'
        console.log("y: ", y)
        ctx.fillText('_', x - 5, y)
        
      }
      //let horizontalCursorPosition = 3*5
      //let verticalCursorPosition = 8*10
      let horizontalCursorPosition = 0
      let verticalCursorPosition = 0
      let gKey = ''
      let key = ""
      //@let gInsert = false
      
      
      let counter = 0
      


      var keyState = {}
      let variableForMaking = ""
      document.addEventListener('keydown', function(e){
        
        keyState[e.keyCode || e.which] = true;
        variableForMaking = e.keyCode
        //gKey = e.key
        
        }, true)
      
      document.addEventListener('keyup', function(e){
       
      keyState[e.keyCode || e.which] = false;
      variableForMaking = e.keyCode
      gKey = e.key
     
      }, true)
      
     function wait(){

      alert(gKey)
      if(gKey !== "ArrowRight" && gKey !== "ArrowLeft" && gKey !== "ArrowUp" && gKey !== "ArrowDown")
      {
        //nestedArray = Recursive.initialInsert(verticalCursorPosition/10, horizontalCursorPosition/5, nestedArray, gKey)
        //nestedArray =  Recursive.pullTextBackToTop(true, gKey, nestedArray, verticalCursorPosition/10, horizontalCursorPosition/5)
        //nestedArray = Recursive.pushWords(true, nestedArray,[gKey],verticalCursorPosition/10, horizontalCursorPosition/5)
      }
      return
    }

    function dummy(){

    }



    /////////////////WORKING HERE, SETTING TIMER STUFF//////////////    190 and 200

    function pressedAdd(){
      if(adjustableSpeed >= MAXSPEED){
      adjustableSpeed = MAXSPEED}
      else{
      adjustableSpeed++
      }
      speedAdjust.innerHTML =
      `Cursor speed: ${(MAXSPEED  - adjustableSpeed)}%   `
    }

    function pressedSubtract(){
      if(adjustableSpeed <= 0){
      adjustableSpeed = 0}
      else{
      adjustableSpeed--
      }
      speedAdjust.innerHTML =
      `Cursor speed: ${(MAXSPEED + adjustableSpeed)}%   ` 
    }
     
      function printCharacter() {

      let flagForCursor = false
      if(keyState[107]){
      pressedAdd()
      }
      else if(keyState[109]){
      pressedSubtract()
      }
      //right
      else if(keyState[39]){
        
        CursorMovements.cursorRight()
      }
      //left
      else if(keyState[37]){
        CursorMovements.cursorLeft()
        
      }
      //up
      else if(keyState[38]){
        CursorMovements.cursorUp()
      }
      //down
      else if(keyState[40]){
        CursorMovements.cursorDown()
      } 
      else if(keyState[variableForMaking]){
      let keyOfArray = variable.find(o =>  o.code === variableForMaking)
      if(keyOfArray === undefined){
      }
      else{
      gKey = keyOfArray.value
      Recursive.test(gKey, nestedArray, verticalCursorPosition/10)
      }
      }
      setTimeout(dummy, 2) 
      let rowIndex = horizontalCursorPosition/5;
      let colIndex = verticalCursorPosition/10;
      //ctx.clearRect(0, 0, 300, 300)
      //nestedArray = Recursive.initialInsert(verticalCursorPosition/10, horizontalCursorPosition/5, nestedArray, gKey)
      //nestedArray =  Recursive.pullTextBackToTop(true, gKey, nestedArray, verticalCursorPosition/10, horizontalCursorPosition/5)
      //nestedArray = Recursive.pushWords(true, nestedArray,[gKey],verticalCursorPosition/10, horizontalCursorPosition/5)
      Recursive.displayGridAndCursor()  
      setTimeout(printCharacter, MAXSPEED - adjustableSpeed)
      }  
      printCharacter()
      
/*      

      const test = document.addEventListener('keydown', function (e) {

      else if(gKey == 'Enter')
      {
        HEIGHT++
        //nestedArray = Recursive.pressedEnter(nestedArray, verticalCursorPosition/10, horizontalCursorPosition/5, [], [], true)
        const t0 = performance.now()
        let a = pausehere
      
      }
      
      else if(gKey == 'Delete')
      {
        alert("delete")
          console.log("nested array3: ", nestedArray);
          //4 functions:
          nestedArray = Recursive.deleteACharacterKickStart([], verticalCursorPosition/10, horizontalCursorPosition/5-1,  nestedArray, true)
          //nestedArray =  Recursive.pullTextBackToTop(true, nestedArray, verticalCursorPosition/10, horizontalCursorPosition/5)
          //nestedArray = Recursive.pushWords(true, nestedArray,[],verticalCursorPosition/10, horizontalCursorPosition   
      }
    })
   
*/  

      
    
    
      //window.addEventListener('keydown', function (e) {
      //  if (
      //    ['Space', 'ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].indexOf(
      //      e.code
      //    ) > -1
      //  ) {
      //    e.preventDefault()
      //  }
      //})
      //
      //xAndY.innerHTML = 'X: ' + 0 + '  &nbsp&nbsp&nbsp   Y: ' + 0
      </script>
    </body>
