<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
<body>
  <script src="cursorMovements.js"></script>
  <script src="customBox.js"></script>
  <script src="recursive.js"></script>
  <script>
    const CursorMovements = new CursorMovementsClass()
    const customBox1 = new CustomBoxClass()
    const Recursive = new RecursiveClass() 
    </script>
    <canvas
      id="canvas_id"
      width="220"
      height="240"
      style="border: 1px solid #550233"
    > </canvas>
    <button id="button6" onclick="TextArea.displayTextBoxCopy()">
      Display Text
    </button>
    <div></div>
    <div id="xAndY"></div>
    <script>


    // The grid, last row is a padding for recursion. 
    let nestedArray = [
    ["1", "-", "-", "-", "-", "-" , "-" ],
    ["-", "-", "-", "-", "-", "-" , "-" ],
    ["-", "-", "-", "1", "-", "-" , "-" ],
    ["-", "-", "-", "-", "-", "-" , "-" ],
    ["-", "-", "-", "-", "-" , "-", "-" ],
    ["-", "-", "-", "-", "-", "-" , "-" ],
    ["1", "2", "3", "4", "5", "6" , "7" ],
    ["!", "!", "!", "1", "!", "!" , "!" ],
  ];
      //canvas
      let WIDTH = 7
      let HEIGHT = 7
      const VOFFSET = 25
      const HOFFSET = 30
      var canvas = document.getElementById('canvas_id')
      var insertOn = document.getElementById('insert')
      let textBox = [[]]
      let rows = WIDTH
      let cols = HEIGHT
      let ctx = canvas.getContext('2d')
      var size = 220
      canvas.style.width = size + 'px'
      canvas.style.height = size + 'px'
      var scale = window.devicePixelRatio 
      canvas.width = size * scale
      canvas.height = size * scale
      ctx.scale(scale, scale)
      ctx.fillStyle = '#ffffff'
      ctx.fillRect(0, 0, 800, 800)
      ctx.fillStyle = '#000000'
      ctx.font = '10px Monospace'
      ctx.textAlign = 'center'
      ctx.textBaseline = 'middle'
      var x = size / 2
      var y = size / 2
      //@var indexOfXForLineBeforeLastRowSpace = 0
      //@var lastIndexValueForInsert = -1
      //@var firstLengthOfOverlap = 0
      //@var sencondLengthOfOverlap = 0
  
    
      
    function clearArray() {
        ctx.clearRect(0, 0, 100, 100)
        ctx.fillStyle = '#ffffff'
        ctx.fillRect(0, 0, canvas.width, canvas.height)
        ctx.fillStyle = '#000000'
      }


    //function drawGrid(iValue = HEIGHT, jValue = WIDTH) {
    function drawGrid(iValue = HEIGHT, jValue = WIDTH) {
        clearArray()
        ctx.fillStyle = 'black'
        for (let i = 0; i < iValue; i++) {
        for (let j = 0; j < jValue ; j++) {
        console.log("na: ", nestedArray)
        if(nestedArray && nestedArray[i] && nestedArray[i][j]){
        //fill text with offsets
        ctx.fillText(nestedArray[i][j], j * 5 + 25, i * 10 + 25)
        console.log({j}, {i})
        }else{
          continue
        }
        }
      }
    }
    
    
    function drawCursor(x,y){
        if(x === 65){
          if(x == HOFFSET + (WIDTH * 5))
          x = 0 + HOFFSET;
          console.log("y1: ", y)
          y =y + 10
          console.log("y2: ", y)
        }
        ctx.font = '10px Monospace'
        ctx.fillStyle = 'red'
        console.log("y: ", y)
        ctx.fillText('_', x - 5, y)
      }
      let horizontalCursorPosition = 0
      let verticalCursorPosition = 0
      let gKey = ''
      //@let gInsert = false
      
      
      //is not called for cursor movement, enter, delete
      //shift, control, tab, escape, backspace
      //Basiclly, an alph-numeric character causes this to happen
      function printCharacter() {
        let rowIndex = horizontalCursorPosition/5;
        let colIndex = verticalCursorPosition/10;
        ctx.clearRect(0, 0, 300, 300)
        console.log('v ', verticalCursorPosition)
        console.log('h ', horizontalCursorPosition)
        let key = "Z"
        console.log("nested array1: ", nestedArray);
        nestedArray = Recursive.insertClean(true, nestedArray, [gKey], verticalCursorPosition/10, horizontalCursorPosition/5 )
        //nestedArray =  Recursive.pullTextBackToTop(nestedArray, verticalCursorPosition/10, horizontalCursorPosition/5)
       console.log("nested array2: ", nestedArray);
        drawGrid( HEIGHT, WIDTH)
        drawCursor(
          horizontalCursorPosition + HOFFSET ,
          verticalCursorPosition + VOFFSET
        )
      }
      
      
      document.addEventListener('keydown', function (e) {
        gKey = e.key
        if(gKey == 'Enter')
        {
          //HEIGHT++
          nestedArray = Recursive.pressedEnter(nestedArray, verticalCursorPosition/10, horizontalCursorPosition/5, [], [], true)
        }
        else if(gKey == 'Delete')
        {
          //@let key = ""
            console.log("nested array3: ", nestedArray);
            //4 functions:
           nestedArray = Recursive.deleteACharacter([], verticalCursorPosition/10, horizontalCursorPosition/5,  nestedArray, true)
            //nestedArray = Recursive.moveWordAcrossBorder(nestedArray, [], verticalCursorPosition/10, horizontalCursorPosition/5)
            //nestedArray =  Recursive.moveAllWordsAcrossBorder(nestedArray, [], verticalCursorPosition/10, horizontalCursorPosition/5)
            //nestedArray =  Recursive.pullTextBackToTop(nestedArray, verticalCursorPosition/10, horizontalCursorPosition/5)
            
        }
        customBox1.controlInput()
      })
      
      
      //window.addEventListener('keydown', function (e) {
      //  if (
      //    ['Space', 'ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].indexOf(
      //      e.code
      //    ) > -1
      //  ) {
      //    e.preventDefault()
      //  }
      //})
      //
      //xAndY.innerHTML = 'X: ' + 0 + '  &nbsp&nbsp&nbsp   Y: ' + 0
      </script>
    </body>
